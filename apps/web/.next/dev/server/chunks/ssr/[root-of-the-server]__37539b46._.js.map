{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/jira/UMS/apps/web/actions/admin-auth.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@ums/lib\";\nimport { cookies } from \"next/headers\";\nimport bcrypt from \"bcryptjs\";\nimport { redirect } from \"next/navigation\";\nimport { requireCsrfToken } from \"@/lib/csrf\";\nimport { checkRateLimit, recordFailedAttempt, resetRateLimit } from \"@/lib/rate-limit\";\n\n/**\n * Login Admin – ตรวจสอบ email/password แล้วตั้ง cookie admin_session\n */\nexport async function loginAdmin(formData: FormData) {\n    // CSRF Protection\n    await requireCsrfToken(formData);\n\n    // Rate Limiting Check\n    const rateLimitError = await checkRateLimit();\n    if (rateLimitError) {\n        throw new Error(rateLimitError);\n    }\n\n    const email = (formData.get(\"email\") as string)?.trim();\n    const password = (formData.get(\"password\") as string);\n\n    if (!email || !password) {\n        throw new Error(\"Email and password are required\");\n    }\n\n    const user = await prisma.user.findUnique({\n        where: { email },\n        select: {\n            id: true,\n            email: true,\n            passwordHash: true,\n            role: true,\n            twoFactorEnabled: true,\n            twoFactorSecret: true,\n            personnelProfile: {\n                select: {\n                    id: true,\n                    firstName: true,\n                    lastName: true,\n                },\n            },\n        },\n    });\n\n    if (!user || user.role !== \"ADMIN\" || !user.personnelProfile) {\n        await recordFailedAttempt(); // Record failed attempt\n        throw new Error(\"Invalid credentials\");\n    }\n\n    const passwordMatch = await bcrypt.compare(password, user.passwordHash);\n    if (!passwordMatch) {\n        await recordFailedAttempt(); // Record failed attempt\n        throw new Error(\"Invalid credentials\");\n    }\n\n    // Check if user has 2FA enabled\n    if (user.twoFactorEnabled && user.twoFactorSecret) {\n        // Store temporary session for 2FA verification\n        (await cookies()).set({\n            name: \"admin_2fa_pending\",\n            value: JSON.stringify({\n                userId: user.id,\n                role: user.role,\n                personnelId: user.personnelProfile.id,\n            }),\n            httpOnly: true,\n            path: \"/\",\n            maxAge: 5 * 60, // 5 minutes\n        });\n\n        // Redirect to 2FA verification page\n        redirect(\"/admin/login/verify\");\n    }\n\n    // No 2FA - proceed with normal login\n    const session = {\n        userId: user.id,\n        role: user.role,\n        personnelId: user.personnelProfile.id,\n    };\n\n    // Reset rate limit on successful login\n    await resetRateLimit();\n\n    (await cookies()).set({\n        name: \"admin_session\",\n        value: JSON.stringify(session),\n        httpOnly: true,\n        path: \"/\",\n        // secure: process.env.NODE_ENV === \"production\",\n        maxAge: 60 * 60 * 24 * 7,\n    });\n\n    redirect(\"/admin\");\n}\n\n/** Logout Admin */\nexport async function logoutAdmin() {\n    (await cookies()).delete(\"admin_session\");\n    redirect(\"/admin/login\");\n}\n\n/**\n * Verify 2FA code and complete login\n */\nexport async function verify2FALogin(code: string) {\n    // Get pending session\n    const pendingCookie = (await cookies()).get(\"admin_2fa_pending\");\n\n    if (!pendingCookie) {\n        throw new Error(\"No pending 2FA verification. Please login again.\");\n    }\n\n    let pendingSession;\n    try {\n        pendingSession = JSON.parse(pendingCookie.value);\n    } catch (e) {\n        throw new Error(\"Invalid session data\");\n    }\n\n    // Import verify function\n    const { verify2FACode } = await import(\"@/lib/two-factor\");\n\n    // Verify the 2FA code\n    const isValid = await verify2FACode(pendingSession.userId, code);\n\n    if (!isValid) {\n        await recordFailedAttempt();\n        throw new Error(\"Invalid verification code\");\n    }\n\n    // Delete pending session\n    (await cookies()).delete(\"admin_2fa_pending\");\n\n    // Reset rate limit\n    await resetRateLimit();\n\n    // Create actual session\n    (await cookies()).set({\n        name: \"admin_session\",\n        value: JSON.stringify(pendingSession),\n        httpOnly: true,\n        path: \"/\",\n        // secure: process.env.NODE_ENV === \"production\",\n        maxAge: 60 * 60 * 24 * 7,\n    });\n\n    redirect(\"/admin\");\n}\n"],"names":[],"mappings":";;;;;;;IAqGsB,cAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/jira/UMS/apps/web/components/sidebar.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { logoutAdmin } from \"@/actions/admin-auth\";\nimport {\n    LayoutDashboard,\n    BookOpen,\n    Users,\n    GraduationCap,\n    Settings,\n    LogOut,\n    Menu,\n    ChevronRight,\n    FileText,\n    Calendar,\n    DollarSign,\n    Megaphone,\n    BarChart3,\n    Image,\n    Bot,\n    HelpCircle,\n    FolderOpen,\n    Globe,\n    Target,\n    Tags,\n    Building2,\n    Building,\n    BookMarked,\n    CalendarDays,\n    CalendarCheck,\n    DoorOpen,\n    ClipboardList,\n    Wallet,\n    UserPlus,\n    Briefcase,\n    Shield,\n    UserCog,\n} from \"lucide-react\";\nimport * as Icons from \"lucide-react\";\nimport { useState } from \"react\";\n\nconst navigation = [\n    {\n        category: \"Overview\",\n        items: [\n            {\n                title: \"Dashboard\",\n                href: \"/admin\",\n                icon: LayoutDashboard,\n            },\n        ],\n    },\n    {\n        category: \"Academic\",\n        items: [\n            {\n                title: \"Faculties\",\n                href: \"/admin/academic/program/faculties\",\n                icon: Building2,\n            },\n            {\n                title: \"Departments\",\n                href: \"/admin/academic/program/departments\",\n                icon: Building,\n            },\n            {\n                title: \"Programs\",\n                href: \"/admin/academic/program/programs\",\n                icon: BookOpen,\n            },\n            {\n                title: \"Courses\",\n                href: \"/admin/academic/program/courses\",\n                icon: BookMarked,\n            },\n            {\n                title: \"Student Groups\",\n                href: \"/admin/academic/groups\",\n                icon: Users,\n            },\n        ],\n    },\n    {\n        category: \"Admissions\",\n        items: [\n            {\n                title: \"Dashboard\",\n                href: \"/admin/admissions\",\n                icon: LayoutDashboard,\n            },\n            {\n                title: \"Applications\",\n                href: \"/admin/admissions/applications\",\n                icon: FileText,\n            },\n            {\n                title: \"Interviews\",\n                href: \"/admin/admissions/interviews\",\n                icon: Calendar,\n            },\n            {\n                title: \"Admission Tracks\",\n                href: \"/admin/admissions/tracks\",\n                icon: Target,\n            },\n            {\n                title: \"Track Types\",\n                href: \"/admin/admissions/track-types\",\n                icon: Icons.Tags,\n            },\n        ],\n    },\n    {\n        category: \"Schedule Management\",\n        items: [\n            {\n                title: \"Class Timetable\",\n                href: \"/admin/schedule/timetable\",\n                icon: CalendarDays,\n            },\n            {\n                title: \"Teaching Schedule\",\n                href: \"/admin/schedule/teaching\",\n                icon: CalendarCheck,\n            },\n            {\n                title: \"Room Allocation\",\n                href: \"/admin/schedule/rooms\",\n                icon: DoorOpen,\n            },\n            {\n                title: \"Exam Schedule\",\n                href: \"/admin/schedule/exams\",\n                icon: ClipboardList,\n            },\n        ],\n    },\n    {\n        category: \"Finance & Accounting\",\n        items: [\n            {\n                title: \"Student Billing\",\n                href: \"/admin/finance/billing\",\n                icon: Wallet,\n            },\n            {\n                title: \"Payments\",\n                href: \"/admin/finance/payments\",\n                icon: DollarSign,\n            },\n            {\n                title: \"Scholarships\",\n                href: \"/admin/finance/scholarships\",\n                icon: Icons.Award,\n            },\n            {\n                title: \"Financial Aid\",\n                href: \"/admin/finance/aid\",\n                icon: Icons.HandHeart,\n            },\n            {\n                title: \"Fee Structure\",\n                href: \"/admin/finance/fees\",\n                icon: Icons.Receipt,\n            },\n            {\n                title: \"Reports\",\n                href: \"/admin/finance/reports\",\n                icon: BarChart3,\n            },\n        ],\n    },\n    {\n        category: \"User Management\",\n        items: [\n            {\n                title: \"Applicants\",\n                href: \"/admin/users/applicants\",\n                icon: UserPlus,\n            },\n            {\n                title: \"Students\",\n                href: \"/admin/users/students\",\n                icon: GraduationCap,\n            },\n            {\n                title: \"Alumni\",\n                href: \"/admin/users/alumni\",\n                icon: Icons.Award,\n            },\n            {\n                title: \"Instructors\",\n                href: \"/admin/users/instructors\",\n                icon: BookOpen,\n            },\n            {\n                title: \"Staff\",\n                href: \"/admin/users/staff\",\n                icon: Briefcase,\n            },\n            {\n                title: \"Administrators\",\n                href: \"/admin/users/administrators\",\n                icon: Shield,\n            },\n            {\n                title: \"Roles & Permissions\",\n                href: \"/admin/users/roles\",\n                icon: UserCog,\n            },\n        ],\n    },\n    {\n        category: \"Web Management\",\n        items: [\n            {\n                title: \"Announcements\",\n                href: \"/admin/announcements\",\n                icon: Megaphone,\n            },\n            {\n                title: \"Website Banners\",\n                href: \"/admin/cms/banners\",\n                icon: Image,\n            },\n        ],\n    },\n    {\n        category: \"System\",\n        items: [\n            {\n                title: \"Academic Terms\",\n                href: \"/admin/academic\",\n                icon: Calendar,\n            },\n            {\n                title: \"Reports & Analytics\",\n                href: \"/admin/analytics\",\n                icon: BarChart3,\n            },\n            {\n                title: \"AI Agent\",\n                href: \"/admin/ai-agent\",\n                icon: Bot,\n            },\n            {\n                title: \"Help Center\",\n                href: \"/admin/help-center\",\n                icon: HelpCircle,\n            },\n            {\n                title: \"File Management\",\n                href: \"/admin/files\",\n                icon: FolderOpen,\n            },\n            {\n                title: \"Settings\",\n                href: \"/admin/settings\",\n                icon: Settings,\n            },\n            {\n                title: \"Translations\",\n                href: \"/admin/settings/translations\",\n                icon: Globe,\n            },\n        ],\n    },\n];\n\nexport function Sidebar() {\n    const pathname = usePathname();\n    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n\n    return (\n        <>\n            {/* Mobile Menu Button */}\n            <button\n                className=\"fixed left-4 top-20 z-40 rounded-lg bg-white p-2 shadow-md md:hidden\"\n                onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\n            >\n                <Menu className=\"h-6 w-6 text-gray-600\" />\n            </button>\n\n            {/* Sidebar Container */}\n            <aside\n                className={`fixed inset-y-0 left-0 top-16 z-30 w-64 transform border-r border-gray-200 bg-white pb-10 transition-transform duration-200 ease-in-out md:translate-x-0 ${isMobileMenuOpen ? \"translate-x-0\" : \"-translate-x-full\"\n                    }`}\n            >\n                <div className=\"h-full overflow-y-auto py-6 pl-4 pr-2\">\n                    {navigation.map((section) => (\n                        <div key={section.category} className=\"mb-8\">\n                            <h3 className=\"mb-3 px-4 text-xs font-bold uppercase tracking-wider text-gray-400\">\n                                {section.category}\n                            </h3>\n                            <div className=\"space-y-1\">\n                                {section.items.map((item) => {\n                                    const isActive =\n                                        pathname === item.href ||\n                                        (item.href !== \"/admin\" && pathname.startsWith(`${item.href}/`));\n                                    // Special case for Dashboard\n                                    const isExactActive =\n                                        item.href === \"/admin\" ? pathname === \"/admin\" : isActive;\n\n                                    return (\n                                        <Link\n                                            key={item.href}\n                                            href={item.href}\n                                            className={`group flex items-center justify-between rounded-md px-4 py-2 text-sm font-medium transition-all duration-200 ${isExactActive\n                                                ? \"bg-blue-50 text-blue-700\"\n                                                : \"text-gray-600 hover:bg-gray-50 hover:text-gray-900\"\n                                                }`}\n                                        >\n                                            <div className=\"flex items-center\">\n                                                <item.icon\n                                                    className={`mr-3 h-4 w-4 ${isExactActive\n                                                        ? \"text-blue-600\"\n                                                        : \"text-gray-400 group-hover:text-gray-500\"\n                                                        }`}\n                                                />\n                                                {item.title}\n                                            </div>\n                                            {isExactActive && (\n                                                <ChevronRight className=\"h-4 w-4 text-blue-500\" />\n                                            )}\n                                        </Link>\n                                    );\n                                })}\n                            </div>\n                        </div>\n                    ))}\n\n                    {/* Bottom Actions */}\n                    <div className=\"mt-auto px-4 pt-6\">\n                        <form action={logoutAdmin} className=\"w-full\">\n                            <button\n                                type=\"submit\"\n                                className=\"flex w-full items-center rounded-md px-4 py-2 text-sm font-medium text-red-600 transition-all hover:bg-red-50\"\n                            >\n                                <LogOut className=\"mr-3 h-4 w-4\" />\n                                Sign Out\n                            </button>\n                        </form>\n                    </div>\n                </div>\n            </aside>\n\n            {/* Overlay for mobile */}\n            {isMobileMenuOpen && (\n                <div\n                    className=\"fixed inset-0 z-20 bg-gray-600 bg-opacity-50 transition-opacity md:hidden\"\n                    onClick={() => setIsMobileMenuOpen(false)}\n                />\n            )}\n        </>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkCA;AAAA;AAAA;AAAA;AACA;AAxCA;;;;;;;;AA0CA,MAAM,aAAa;IACf;QACI,UAAU;QACV,OAAO;YACH;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,+OAAe;YACzB;SACH;IACL;IACA;QACI,UAAU;QACV,OAAO;YACH;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,6NAAS;YACnB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,sNAAQ;YAClB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,0NAAQ;YAClB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,gOAAU;YACpB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,6MAAK;YACf;SACH;IACL;IACA;QACI,UAAU;QACV,OAAO;YACH;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,+OAAe;YACzB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,0NAAQ;YAClB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,sNAAQ;YAClB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,gNAAM;YAChB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,0MAAU;YACpB;SACH;IACL;IACA;QACI,UAAU;QACV,OAAO;YACH;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,sOAAY;YACtB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,yOAAa;YACvB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,0NAAQ;YAClB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,yOAAa;YACvB;SACH;IACL;IACA;QACI,UAAU;QACV,OAAO;YACH;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,gNAAM;YAChB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,gOAAU;YACpB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,6MAAW;YACrB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,6NAAe;YACzB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,mNAAa;YACvB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,+NAAS;YACnB;SACH;IACL;IACA;QACI,UAAU;QACV,OAAO;YACH;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,0NAAQ;YAClB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,yOAAa;YACvB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,6MAAW;YACrB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,0NAAQ;YAClB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,yNAAS;YACnB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,gNAAM;YAChB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,uNAAO;YACjB;SACH;IACL;IACA;QACI,UAAU;QACV,OAAO;YACH;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,yNAAS;YACnB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,6MAAK;YACf;SACH;IACL;IACA;QACI,UAAU;QACV,OAAO;YACH;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,sNAAQ;YAClB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,+NAAS;YACnB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,uMAAG;YACb;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,4OAAU;YACpB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,gOAAU;YACpB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,sNAAQ;YAClB;YACA;gBACI,OAAO;gBACP,MAAM;gBACN,MAAM,6MAAK;YACf;SACH;IACL;CACH;AAEM,SAAS;IACZ,MAAM,WAAW,IAAA,iJAAW;IAC5B,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAC;IAEzD,qBACI;;0BAEI,8OAAC;gBACG,WAAU;gBACV,SAAS,IAAM,oBAAoB,CAAC;0BAEpC,cAAA,8OAAC,0MAAI;oBAAC,WAAU;;;;;;;;;;;0BAIpB,8OAAC;gBACG,WAAW,CAAC,yJAAyJ,EAAE,mBAAmB,kBAAkB,qBACtM;0BAEN,cAAA,8OAAC;oBAAI,WAAU;;wBACV,WAAW,GAAG,CAAC,CAAC,wBACb,8OAAC;gCAA2B,WAAU;;kDAClC,8OAAC;wCAAG,WAAU;kDACT,QAAQ,QAAQ;;;;;;kDAErB,8OAAC;wCAAI,WAAU;kDACV,QAAQ,KAAK,CAAC,GAAG,CAAC,CAAC;4CAChB,MAAM,WACF,aAAa,KAAK,IAAI,IACrB,KAAK,IAAI,KAAK,YAAY,SAAS,UAAU,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC,CAAC;4CAClE,6BAA6B;4CAC7B,MAAM,gBACF,KAAK,IAAI,KAAK,WAAW,aAAa,WAAW;4CAErD,qBACI,8OAAC,uKAAI;gDAED,MAAM,KAAK,IAAI;gDACf,WAAW,CAAC,6GAA6G,EAAE,gBACrH,6BACA,sDACA;;kEAEN,8OAAC;wDAAI,WAAU;;0EACX,8OAAC,KAAK,IAAI;gEACN,WAAW,CAAC,aAAa,EAAE,gBACrB,kBACA,2CACA;;;;;;4DAET,KAAK,KAAK;;;;;;;oDAEd,+BACG,8OAAC,sOAAY;wDAAC,WAAU;;;;;;;+CAjBvB,KAAK,IAAI;;;;;wCAqB1B;;;;;;;+BApCE,QAAQ,QAAQ;;;;;sCA0C9B,8OAAC;4BAAI,WAAU;sCACX,cAAA,8OAAC;gCAAK,QAAQ,6KAAW;gCAAE,WAAU;0CACjC,cAAA,8OAAC;oCACG,MAAK;oCACL,WAAU;;sDAEV,8OAAC,oNAAM;4CAAC,WAAU;;;;;;wCAAiB;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAStD,kCACG,8OAAC;gBACG,WAAU;gBACV,SAAS,IAAM,oBAAoB;;;;;;;;AAKvD"}},
    {"offset": {"line": 460, "column": 0}, "map": {"version":3,"sources":["file:///Users/jira/UMS/apps/web/actions/settings.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@ums/lib\";\nimport { revalidatePath } from \"next/cache\";\nimport { getAdminSession } from \"./auth\";\n\nexport async function getSystemSettings() {\n    let settings = await prisma.systemSettings.findFirst();\n\n    if (!settings) {\n        // Create default settings if not exists\n        settings = await prisma.systemSettings.create({\n            data: {},\n        });\n    } else {\n        // Auto-update legacy defaults if they match the old defaults\n        // This ensures the user sees the requested default values\n        const isOldDefaultName = settings.universityName === \"University Management System\";\n        const isOldDefaultNameTh = settings.universityNameTh === \"ระบบจัดการมหาวิทยาลัย\";\n\n        if (isOldDefaultName || isOldDefaultNameTh) {\n            settings = await prisma.systemSettings.update({\n                where: { id: settings.id },\n                data: {\n                    universityName: isOldDefaultName ? \"University MS\" : settings.universityName,\n                    universityNameTh: isOldDefaultNameTh ? \"ระบบจัดการข้อมูลมหาวิทยาลัย\" : settings.universityNameTh,\n                }\n            });\n        }\n    }\n\n    return settings;\n}\n\nexport async function updateSystemSettings(formData: FormData) {\n    const session = await getAdminSession();\n    if (!session) {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const universityName = formData.get(\"universityName\") as string;\n    const universityNameTh = formData.get(\"universityNameTh\") as string;\n    const logoUrl = formData.get(\"logoUrl\") as string;\n    const primaryColor = formData.get(\"primaryColor\") as string;\n    const secondaryColor = formData.get(\"secondaryColor\") as string;\n    const backgroundColor = formData.get(\"backgroundColor\") as string;\n    const studentIdFormat = formData.get(\"studentIdFormat\") as string;\n    const defaultLanguage = formData.get(\"defaultLanguage\") as string;\n\n    console.log(\"Updating settings:\", { universityName, universityNameTh, logoUrl });\n\n    const settings = await getSystemSettings();\n\n    await prisma.systemSettings.update({\n        where: { id: settings.id },\n        data: {\n            universityName,\n            universityNameTh,\n            logoUrl: logoUrl || null,\n            primaryColor,\n            secondaryColor,\n            backgroundColor,\n            studentIdFormat,\n            defaultLanguage,\n        },\n    });\n\n    revalidatePath(\"/admin/settings\");\n    revalidatePath(\"/\");\n}\n"],"names":[],"mappings":";;;;;;;IAMsB,oBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 472, "column": 0}, "map": {"version":3,"sources":["file:///Users/jira/UMS/apps/web/components/top-nav.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { Search, Bell, User } from \"lucide-react\";\n\nimport { getSystemSettings } from \"@/actions/settings\";\nimport { useEffect, useState } from \"react\";\n\nexport function TopNav() {\n    const [settings, setSettings] = useState<any>(null);\n\n    useEffect(() => {\n        getSystemSettings().then(setSettings);\n    }, []);\n\n    return (\n        <header className=\"sticky top-0 z-50 w-full border-b border-gray-800 bg-[#050f2c] text-white shadow-sm\">\n            <div className=\"flex h-16 items-center justify-between px-4 md:px-6\">\n                {/* Logo Section */}\n                <div className=\"flex items-center gap-2 md:w-64\">\n                    <Link href=\"/admin\" className=\"flex items-center gap-2 font-bold text-xl tracking-tight\">\n                        {settings?.logoUrl ? (\n                            <img\n                                src={settings.logoUrl}\n                                alt=\"Logo\"\n                                className=\"h-10 w-auto object-contain\"\n                            />\n                        ) : (\n                            <>\n                                <div className=\"flex h-8 w-8 items-center justify-center rounded bg-blue-600 text-white\">\n                                    {settings?.universityName ? settings.universityName.charAt(0) : \"U\"}\n                                </div>\n                                <span>\n                                    {settings?.universityName || \"UMS\"}\n                                    <span className=\"text-blue-400 ml-1\">Admin</span>\n                                </span>\n                            </>\n                        )}\n                    </Link>\n                </div>\n\n                {/* Search Bar (Algolia Style) */}\n                <div className=\"hidden flex-1 items-center justify-center md:flex\">\n                    <div className=\"relative w-full max-w-md\">\n                        <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400\" />\n                        <input\n                            type=\"text\"\n                            placeholder=\"Search for students, programs, or settings...\"\n                            className=\"h-10 w-full rounded-lg border-none bg-[#1c2645] pl-10 pr-4 text-sm text-gray-200 placeholder-gray-400 focus:ring-2 focus:ring-blue-500\"\n                        />\n                        <div className=\"absolute right-3 top-1/2 -translate-y-1/2 rounded border border-gray-600 bg-[#050f2c] px-1.5 py-0.5 text-xs text-gray-400\">\n                            ⌘K\n                        </div>\n                    </div>\n                </div>\n\n                {/* Right Actions */}\n                <div className=\"flex items-center gap-4\">\n                    <button className=\"relative rounded-full p-2 hover:bg-[#1c2645] transition-colors\">\n                        <Bell className=\"h-5 w-5 text-gray-300\" />\n                        <span className=\"absolute right-1.5 top-1.5 h-2 w-2 rounded-full bg-red-500 ring-2 ring-[#050f2c]\" />\n                    </button>\n                    <div className=\"flex items-center gap-3 border-l border-gray-700 pl-4\">\n                        <div className=\"hidden text-right md:block\">\n                            <p className=\"text-sm font-medium text-gray-200\">Admin User</p>\n                            <p className=\"text-xs text-gray-400\">System Administrator</p>\n                        </div>\n                        <div className=\"h-9 w-9 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 p-[2px]\">\n                            <div className=\"flex h-full w-full items-center justify-center rounded-full bg-[#050f2c]\">\n                                <User className=\"h-4 w-4 text-white\" />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </header>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAEA;AACA;AANA;;;;;;AAQO,SAAS;IACZ,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAM;IAE9C,IAAA,kNAAS,EAAC;QACN,IAAA,mLAAiB,IAAG,IAAI,CAAC;IAC7B,GAAG,EAAE;IAEL,qBACI,8OAAC;QAAO,WAAU;kBACd,cAAA,8OAAC;YAAI,WAAU;;8BAEX,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC,uKAAI;wBAAC,MAAK;wBAAS,WAAU;kCACzB,UAAU,wBACP,8OAAC;4BACG,KAAK,SAAS,OAAO;4BACrB,KAAI;4BACJ,WAAU;;;;;iDAGd;;8CACI,8OAAC;oCAAI,WAAU;8CACV,UAAU,iBAAiB,SAAS,cAAc,CAAC,MAAM,CAAC,KAAK;;;;;;8CAEpE,8OAAC;;wCACI,UAAU,kBAAkB;sDAC7B,8OAAC;4CAAK,WAAU;sDAAqB;;;;;;;;;;;;;;;;;;;;;;;;8BAQzD,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC;wBAAI,WAAU;;0CACX,8OAAC,gNAAM;gCAAC,WAAU;;;;;;0CAClB,8OAAC;gCACG,MAAK;gCACL,aAAY;gCACZ,WAAU;;;;;;0CAEd,8OAAC;gCAAI,WAAU;0CAA4H;;;;;;;;;;;;;;;;;8BAOnJ,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAO,WAAU;;8CACd,8OAAC,0MAAI;oCAAC,WAAU;;;;;;8CAChB,8OAAC;oCAAK,WAAU;;;;;;;;;;;;sCAEpB,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAE,WAAU;sDAAoC;;;;;;sDACjD,8OAAC;4CAAE,WAAU;sDAAwB;;;;;;;;;;;;8CAEzC,8OAAC;oCAAI,WAAU;8CACX,cAAA,8OAAC;wCAAI,WAAU;kDACX,cAAA,8OAAC,0MAAI;4CAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQhD"}},
    {"offset": {"line": 694, "column": 0}, "map": {"version":3,"sources":["file:///Users/jira/UMS/apps/web/app/admin/layout.tsx"],"sourcesContent":["\"use client\";\nimport { Sidebar } from \"@/components/sidebar\";\nimport { TopNav } from \"@/components/top-nav\";\nimport { usePathname, useRouter } from \"next/navigation\";\nimport { useEffect } from \"react\";\nimport { useSession } from \"next-auth/react\";\n\nexport default function AdminLayout({\n    children,\n}: {\n    children: React.ReactNode;\n}) {\n    const pathname = usePathname();\n    const router = useRouter();\n    const { data: session, status } = useSession();\n    const isLoginPage = pathname === \"/admin/login\";\n    const isLoading = status === \"loading\";\n\n    useEffect(() => {\n        if (!isLoginPage && status === \"unauthenticated\") {\n            router.push(\"/api/auth/signin\"); // Redirect to NextAuth signin\n        } else if (!isLoginPage && status === \"authenticated\") {\n            // Check role\n            const role = (session?.user as any)?.role;\n            if (role !== \"ADMIN\" && role !== \"STAFF\") {\n                router.push(\"/\"); // Unauthorized\n            }\n        }\n    }, [isLoginPage, status, session, router]);\n\n    if (isLoginPage) {\n        return <>{children}</>;\n    }\n\n    if (isLoading) {\n        return (\n            <div className=\"flex min-h-screen items-center justify-center\">\n                <div className=\"text-center\">\n                    <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-blue-600 border-t-transparent\"></div>\n                    <p className=\"mt-4 text-gray-600\">Loading...</p>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-[#f5f7fa]\">\n            <TopNav />\n            <div className=\"flex\">\n                <Sidebar />\n                <main className=\"flex-1 p-6 pt-24 md:p-10 md:pl-72\">\n                    <div className=\"mx-auto max-w-6xl\">{children}</div>\n                </main>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AACA;AALA;;;;;;;AAOe,SAAS,YAAY,EAChC,QAAQ,EAGX;IACG,MAAM,WAAW,IAAA,iJAAW;IAC5B,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,EAAE,MAAM,OAAO,EAAE,MAAM,EAAE,GAAG,IAAA,4JAAU;IAC5C,MAAM,cAAc,aAAa;IACjC,MAAM,YAAY,WAAW;IAE7B,IAAA,kNAAS,EAAC;QACN,IAAI,CAAC,eAAe,WAAW,mBAAmB;YAC9C,OAAO,IAAI,CAAC,qBAAqB,8BAA8B;QACnE,OAAO,IAAI,CAAC,eAAe,WAAW,iBAAiB;YACnD,aAAa;YACb,MAAM,OAAQ,SAAS,MAAc;YACrC,IAAI,SAAS,WAAW,SAAS,SAAS;gBACtC,OAAO,IAAI,CAAC,MAAM,eAAe;YACrC;QACJ;IACJ,GAAG;QAAC;QAAa;QAAQ;QAAS;KAAO;IAEzC,IAAI,aAAa;QACb,qBAAO;sBAAG;;IACd;IAEA,IAAI,WAAW;QACX,qBACI,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;wBAAE,WAAU;kCAAqB;;;;;;;;;;;;;;;;;IAIlD;IAEA,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC,kJAAM;;;;;0BACP,8OAAC;gBAAI,WAAU;;kCACX,8OAAC,gJAAO;;;;;kCACR,8OAAC;wBAAK,WAAU;kCACZ,cAAA,8OAAC;4BAAI,WAAU;sCAAqB;;;;;;;;;;;;;;;;;;;;;;;AAKxD"}}]
}