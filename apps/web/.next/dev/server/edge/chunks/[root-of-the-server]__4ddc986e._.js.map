{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/web/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { getToken } from 'next-auth/jwt';\n\nexport async function middleware(request: NextRequest) {\n    const { pathname } = request.nextUrl;\n\n    // Get NextAuth token\n    // Note: secret must match NEXTAUTH_SECRET in .env\n    const token = await getToken({\n        req: request,\n        secret: process.env.NEXTAUTH_SECRET\n    });\n\n    const isAuthenticated = !!token;\n    const userRole = token?.role as string | undefined;\n\n    // ========================================\n    // 1. Admin Routes Protection\n    // ========================================\n    if (pathname.startsWith('/admin') && !pathname.startsWith('/admin/login')) {\n        if (!isAuthenticated) {\n            return NextResponse.redirect(new URL('/api/auth/signin', request.url));\n        }\n        if (userRole !== 'ADMIN' && userRole !== 'STAFF') {\n            // Redirect to appropriate dashboard based on role, or show error\n            return NextResponse.redirect(new URL('/', request.url));\n        }\n    }\n\n    // ========================================\n    // 2. Student Routes Protection\n    // ========================================\n    if (pathname.startsWith('/student') && !pathname.startsWith('/student/login')) {\n        if (!isAuthenticated) {\n            return NextResponse.redirect(new URL('/api/auth/signin', request.url));\n        }\n        if (userRole !== 'STUDENT') {\n            return NextResponse.redirect(new URL('/', request.url));\n        }\n    }\n\n    // ========================================\n    // 3. Instructor Routes Protection\n    // ========================================\n    if (pathname.startsWith('/instructor') && !pathname.startsWith('/instructor/login')) {\n        if (!isAuthenticated) {\n            return NextResponse.redirect(new URL('/api/auth/signin', request.url));\n        }\n        if (userRole !== 'INSTRUCTOR') {\n            return NextResponse.redirect(new URL('/', request.url));\n        }\n    }\n\n    // ========================================\n    // 4. Applicant Routes Protection\n    // ========================================\n    if (pathname.startsWith('/admissions') &&\n        pathname !== '/admissions' &&\n        !pathname.startsWith('/admissions/login') &&\n        !pathname.startsWith('/admissions/register')) {\n\n        if (!isAuthenticated) {\n            return NextResponse.redirect(new URL('/api/auth/signin', request.url));\n        }\n        if (userRole !== 'APPLICANT') {\n            return NextResponse.redirect(new URL('/', request.url));\n        }\n    }\n\n    // ========================================\n    // 5. Redirect logged-in users away from login pages\n    // ========================================\n    if (isAuthenticated) {\n        if (pathname === '/admin/login' ||\n            pathname === '/student/login' ||\n            pathname === '/instructor/login' ||\n            pathname === '/admissions/login' ||\n            pathname === '/login') {\n\n            // Redirect to dashboard based on role\n            switch (userRole) {\n                case 'ADMIN':\n                case 'STAFF':\n                    return NextResponse.redirect(new URL('/admin', request.url));\n                case 'STUDENT':\n                    return NextResponse.redirect(new URL('/student/dashboard', request.url));\n                case 'INSTRUCTOR':\n                    return NextResponse.redirect(new URL('/instructor/dashboard', request.url));\n                case 'APPLICANT':\n                    return NextResponse.redirect(new URL('/admissions/dashboard', request.url));\n                default:\n                    return NextResponse.redirect(new URL('/', request.url));\n            }\n        }\n    }\n\n    return NextResponse.next();\n}\n\n// Configure which routes should be protected\nexport const config = {\n    matcher: [\n        '/admin/:path*',\n        '/student/:path*',\n        '/instructor/:path*',\n        '/admissions/:path*',\n    ],\n};\n"],"names":[],"mappings":"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"}}]
}